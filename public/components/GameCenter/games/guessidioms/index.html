<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>看图猜成语</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        font-family: "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
      }

      .game-container {
        background: #ffffff;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        text-align: center;
        width: 90%;
        max-width: 500px;
      }

      .idiom-image {
        width: 100%;
        height: 200px;
        object-fit: contain;
        margin: 1rem 0;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
      }

      .input-area {
        display: flex;
        margin: 1rem 0;
      }

      #idiomInput {
        flex: 1;
        padding: 0.8rem 1rem;
        font-size: 1.2rem;
        border: 2px solid #e0e0e0;
        border-radius: 10px 0 0 10px;
        outline: none;
      }

      #checkBtn {
        padding: 0.8rem 1.5rem;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 0 10px 10px 0;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 1.2rem;
      }

      #checkBtn:hover {
        background: #2980b9;
      }

      #result {
        min-height: 50px;
        font-size: 1.2rem;
        color: #2c3e50;
        margin: 1rem 0;
        font-weight: bold;
      }

      #nextBtn {
        font-size: 1.2rem;
        padding: 0.8rem 2rem;
        background: #2ecc71;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 1rem;
      }

      #nextBtn:hover {
        background: #27ae60;
      }

      .controls {
        display: flex;
        justify-content: space-between;
        margin-top: 1rem;
      }

      #showAnswerBtn {
        font-size: 1rem;
        padding: 0.5rem 1rem;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
      }

      #showAnswerBtn:hover {
        background: #c0392b;
      }

      #scoreDisplay {
        font-size: 1.2rem;
        color: #2c3e50;
        margin-bottom: 1rem;
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
      }

      .loading-spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>看图猜成语</h1>
      <div id="scoreDisplay">分数: 0</div>

      <div id="loadingContainer" class="loading">
        <div class="loading-spinner"></div>
      </div>

      <img
        id="idiomImage"
        class="idiom-image"
        style="display: none"
        alt="成语图片"
      />

      <div class="input-area">
        <input type="text" id="idiomInput" placeholder="请输入成语..." />
        <button id="checkBtn">确认</button>
      </div>

      <div id="result"></div>

      <div class="controls">
        <button id="showAnswerBtn">查看答案</button>
        <button id="nextBtn">下一题</button>
      </div>
    </div>

    <script>
      // 游戏状态
      let currentAnswer = "";
      let score = 0;
      let isAnswerShown = false;

      // DOM 元素
      const idiomImage = document.getElementById("idiomImage");
      const idiomInput = document.getElementById("idiomInput");
      const checkBtn = document.getElementById("checkBtn");
      const showAnswerBtn = document.getElementById("showAnswerBtn");
      const nextBtn = document.getElementById("nextBtn");
      const result = document.getElementById("result");
      const scoreDisplay = document.getElementById("scoreDisplay");
      const loadingContainer = document.getElementById("loadingContainer");

      // 加载新题目
      async function loadNewQuestion() {
        try {
          // 显示加载状态
          loadingContainer.style.display = "flex";
          idiomImage.style.display = "none";
          result.textContent = "";
          idiomInput.value = "";
          isAnswerShown = false;

          // 请求新题目
          const response = await fetch(
            "https://xiaoapi.cn/API/game_ktccy.php?msg=开始游戏&id=99"
          );
          const data = await response.json();

          if (data.code === 200) {
            // 加载成功
            currentAnswer = data.data.answer;
            idiomImage.src = data.data.pic;
            idiomImage.onload = () => {
              // 图片加载完成后，显示图片并隐藏加载动画
              loadingContainer.style.display = "none";
              idiomImage.style.display = "block";
            };
          } else {
            throw new Error("获取题目失败");
          }
        } catch (error) {
          console.error("获取题目出错:", error);
          result.textContent = "加载题目失败，请点击下一题重试";
          result.style.color = "#e74c3c";
          loadingContainer.style.display = "none";
        }
      }

      // 检查答案
      function checkAnswer() {
        if (isAnswerShown) {
          result.textContent = "已查看答案，不能提交，请点击下一题";
          result.style.color = "#e74c3c";

          // 3秒后自动清除提示
          setTimeout(() => {
            result.textContent = "";
          }, 3000);
          return;
        }

        const userAnswer = idiomInput.value.trim();
        if (!userAnswer) {
          result.textContent = "请输入答案";
          result.style.color = "#e74c3c";
          return;
        }

        if (userAnswer === currentAnswer) {
          score += 10;
          scoreDisplay.textContent = `分数: ${score}`;
          result.textContent = "🎉 回答正确！";
          result.style.color = "#27ae60";
        } else {
          result.textContent = "❌ 回答错误，请重试或查看答案";
          result.style.color = "#e74c3c";

          // 3秒后自动清除错误提示
          setTimeout(() => {
            result.textContent = "";
          }, 3000);
        }
      }

      // 显示答案
      function showAnswer() {
        if (!currentAnswer) return;

        isAnswerShown = true;
        result.textContent = `正确答案是: ${currentAnswer}`;
        result.style.color = "#3498db";
      }

      // 事件监听
      checkBtn.addEventListener("click", checkAnswer);
      showAnswerBtn.addEventListener("click", showAnswer);
      nextBtn.addEventListener("click", loadNewQuestion);

      // 支持按回车键提交答案
      idiomInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
          checkAnswer();
        }
      });

      // 页面加载时获取第一道题
      window.addEventListener("load", loadNewQuestion);
    </script>
  </body>
</html>
